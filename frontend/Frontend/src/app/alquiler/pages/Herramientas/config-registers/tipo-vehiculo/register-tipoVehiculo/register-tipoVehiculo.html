<section class="container mx-auto px-4 py-8 max-w-2xl">
  <!-- Botón Volver -->
  <div class="mb-4">
    <a routerLink="/admin/estacionamiento/herramientas/config/tipos-vehiculo" class="btn btn-ghost gap-2 text-slate-600 hover:text-slate-800 hover:bg-slate-100">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
        <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8l8 8l1.41-1.41L7.83 13H20z"/>
      </svg>
      Volver a Tipos de Vehículos
    </a>
  </div>

  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">Registrar Nuevo Tipo de Vehículo</h1>
    <p class="text-gray-600">Completa el formulario para crear una nueva categoría de vehículo</p>
  </div>

  <!-- Success Alert -->
  @if (success()) {
    <div class="alert alert-success mb-6">
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>¡Tipo de vehículo creado exitosamente! Redirigiendo...</span>
    </div>
  }

  <!-- Error Alert -->
  @if (error()) {
    <div class="alert alert-error mb-6">
      <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>{{ error() }}</span>
    </div>
  }

  <!-- Form -->
  <div class="card bg-white shadow-xl">
    <div class="card-body">
      <form [formGroup]="tipoVehiculoForm" (ngSubmit)="onSubmit()">
        
        <!-- Categoría -->
        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text font-semibold text-gray-800">Categoría *</span>
          </label>
          <input 
            type="text" 
            placeholder="Ej: Auto, Moto, Camioneta, SUV" 
            class="input input-bordered w-full bg-white text-gray-800 placeholder:text-gray-400" 
            formControlName="categoria"
            [class.input-error]="tipoVehiculoForm.get('categoria')?.invalid && tipoVehiculoForm.get('categoria')?.touched"
          />
          @if (getErrorMessage('categoria')) {
            <label class="label">
              <span class="label-text-alt text-error">{{ getErrorMessage('categoria') }}</span>
            </label>
          }
        </div>

        <!-- Descripción -->
        <div class="form-control w-full mb-4">
          <label class="label">
            <span class="label-text font-semibold text-gray-800">Descripción *</span>
          </label>
          <textarea 
            placeholder="Describe las características de este tipo de vehículo" 
            class="textarea textarea-bordered h-24 bg-white text-gray-800 placeholder:text-gray-400" 
            formControlName="descripcion"
            [class.textarea-error]="tipoVehiculoForm.get('descripcion')?.invalid && tipoVehiculoForm.get('descripcion')?.touched"
          ></textarea>
          @if (getErrorMessage('descripcion')) {
            <label class="label">
              <span class="label-text-alt text-error">{{ getErrorMessage('descripcion') }}</span>
            </label>
          }
        </div>

        <!-- Tarifa -->
        <div class="form-control w-full mb-6">
          <label class="label">
            <span class="label-text font-semibold text-gray-800">Tarifa Aplicable *</span>
          </label>
          
          @if (isLoadingTarifas()) {
            <div class="flex items-center gap-2 p-4 bg-slate-100 rounded-lg">
              <span class="loading loading-spinner loading-sm text-gray-800"></span>
              <span class="text-sm text-gray-800 font-medium">Cargando tarifas disponibles...</span>
            </div>
          } @else if (tarifas().length === 0) {
            <div class="alert alert-warning bg-yellow-50 border border-yellow-200">
              <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6 text-yellow-700" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
              </svg>
              <div>
                <span class="font-semibold text-gray-800">No hay tarifas disponibles</span>
                <p class="text-sm text-gray-700">Debes crear al menos una tarifa antes de registrar un tipo de vehículo.</p>
                <a routerLink="/admin/estacionamiento/herramientas/config/registrar-tarifa" class="btn btn-sm btn-primary mt-2">
                  Crear Tarifa
                </a>
              </div>
            </div>
          } @else {
            <select 
              class="select select-bordered w-full bg-white text-gray-800 font-medium border-gray-300" 
              formControlName="tipoTarifaId"
              [class.select-error]="tipoVehiculoForm.get('tipoTarifaId')?.invalid && tipoVehiculoForm.get('tipoTarifaId')?.touched"
            >
              <option value="" disabled selected class="text-gray-500">Selecciona una tarifa</option>
              @for (tarifa of tarifas(); track tarifa.id) {
                <option [value]="tarifa.id" class="text-gray-800 bg-white">
                  {{ tarifa.tipoTarifa }} - ${{ tarifa.precioHora }}/hora | ${{ tarifa.precioDia }}/día
                </option>
              }
            </select>
            
            @if (tipoVehiculoForm.get('tipoTarifaId')?.value) {
              <div class="mt-3 p-4 bg-emerald-50 border-l-4 border-emerald-600 rounded-lg">
                <div class="flex items-start gap-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-emerald-600 flex-shrink-0" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8m.31-8.86c-1.77-.45-2.34-.94-2.34-1.67c0-.84.79-1.43 2.1-1.43c1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81c0 1.79 1.49 2.69 3.66 3.21c1.95.46 2.34 1.15 2.34 1.87c0 .53-.39 1.39-2.1 1.39c-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77c-.01-2.2-1.9-2.96-3.66-3.42"/>
                  </svg>
                  <div class="flex-1">
                    <p class="text-emerald-800 font-semibold text-base">
                      Los vehículos tipo 
                      <span class="font-bold">{{ tipoVehiculoForm.get('categoria')?.value || '[Categoría]' }}</span> 
                      pagarán 
                      <span class="font-bold">{{ getTarifaInfo(tipoVehiculoForm.get('tipoTarifaId')?.value) }}</span>
                    </p>
                    <p class="text-emerald-700 text-sm mt-1">
                      según la tarifa seleccionada
                    </p>
                  </div>
                </div>
              </div>
            }
          }
          
          @if (getErrorMessage('tipoTarifaId')) {
            <label class="label">
              <span class="label-text-alt text-error">{{ getErrorMessage('tipoTarifaId') }}</span>
            </label>
          }
        </div>

        <!-- Actions -->
        <div class="flex justify-end gap-4">
          <a routerLink="/admin/estacionamiento/herramientas/config/tipos-vehiculo" class="btn btn-ghost">
            Cancelar
          </a>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="isSubmitting()"
          >
            @if (isSubmitting()) {
              <span class="loading loading-spinner"></span>
            }
            {{ isSubmitting() ? 'Guardando...' : 'Guardar Tipo de Vehículo' }}
          </button>
        </div>
      </form>
    </div>
  </div>


