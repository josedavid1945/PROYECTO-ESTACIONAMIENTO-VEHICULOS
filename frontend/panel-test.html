<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control - Estacionamiento (TEST)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .connection-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .connection-status {
            text-align: center;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .connected {
            background: #4caf50;
            color: white;
        }

        .disconnected {
            background: #f44336;
            color: white;
        }

        .connection-form {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .connection-form input {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .connection-form button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }

        .btn-connect {
            background: #4caf50;
            color: white;
        }

        .btn-disconnect {
            background: #f44336;
            color: white;
        }

        .btn-request {
            background: #2196f3;
            color: white;
        }

        button:hover {
            opacity: 0.9;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .card .value {
            font-size: 2em;
            font-weight: bold;
            color: #333;
        }

        .card .value.money {
            color: #4caf50;
        }

        .card .value.spaces {
            color: #2196f3;
        }

        .sections {
            display: grid;
            gap: 20px;
        }

        .section-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .section-header h3 {
            color: #667eea;
            font-size: 1.3em;
        }

        .section-stats {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
        }

        .stat {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .stat.available {
            background: #e7f3e7;
            color: #4caf50;
        }

        .stat.occupied {
            background: #ffe7e7;
            color: #f44336;
        }

        .spaces-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }

        .space {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
            font-size: 0.85em;
        }

        .space.available {
            background: #4caf50;
            color: white;
        }

        .space.occupied {
            background: #f44336;
            color: white;
        }

        .space:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .space-info {
            font-size: 0.75em;
            margin-top: 3px;
            opacity: 0.9;
        }

        .timestamp {
            text-align: center;
            color: white;
            margin-top: 20px;
            font-size: 0.9em;
        }

        .logs-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .logs-panel h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .logs {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 6px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
        }

        .log-entry {
            padding: 5px;
            border-bottom: 1px solid #ddd;
        }

        .log-entry.info {
            color: #2196f3;
        }

        .log-entry.success {
            color: #4caf50;
        }

        .log-entry.error {
            color: #f44336;
        }

        .actions-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .actions-panel h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .simulator-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .simulator-panel h3 {
            color: #ff9800;
            margin-bottom: 15px;
        }

        .simulator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .simulator-card {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ff9800;
        }

        .simulator-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .simulator-card input,
        .simulator-card select {
            width: 100%;
            padding: 8px;
            margin-bottom: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .simulator-card button {
            width: 100%;
            padding: 8px;
            background: #ff9800;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .simulator-card button:hover {
            background: #f57c00;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            max-width: 300px;
            animation: slideIn 0.3s;
            z-index: 1000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.entrada {
            border-left: 4px solid #f44336;
        }

        .notification.salida {
            border-left: 4px solid #4caf50;
        }

        .notification h4 {
            margin-bottom: 8px;
            color: #333;
        }

        .notification p {
            color: #666;
            font-size: 0.9em;
            margin: 3px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó Panel de Control - Estacionamiento (TEST)</h1>
        
        <!-- Panel de Conexi√≥n -->
        <div class="connection-panel">
            <div id="connection-status" class="connection-status disconnected">
                ‚ö†Ô∏è Desconectado
            </div>
            
            <div class="connection-form">
                <input type="text" id="ws-url" value="ws://localhost:8081/ws" placeholder="WebSocket URL">
                <button id="btn-connect" class="btn-connect">Conectar</button>
                <button id="btn-disconnect" class="btn-disconnect" disabled>Desconectar</button>
            </div>
        </div>

        <!-- Panel de Acciones R√°pidas -->
        <div class="actions-panel">
            <h3>‚ö° Acciones R√°pidas</h3>
            <div class="actions-grid">
                <button class="btn-request" onclick="requestDashboard()">üìä Solicitar Dashboard</button>
                <button class="btn-request" onclick="requestEspaciosPorSeccion()">üè¢ Espacios por Secci√≥n</button>
                <button class="btn-request" onclick="requestEspaciosDisponibles()">‚úÖ Espacios Disponibles</button>
                <button class="btn-request" onclick="requestTicketsActivos()">üé´ Tickets Activos</button>
            </div>
        </div>

        <!-- Panel de Simulaci√≥n -->
        <div class="simulator-panel">
            <h3>üß™ Simulador de Eventos (Solo para Testing)</h3>
            <div class="simulator-grid">
                <div class="simulator-card">
                    <h4>üöó Simular Entrada de Veh√≠culo</h4>
                    <input type="text" id="sim-entrada-espacio" placeholder="N√∫mero de espacio (ej: A-101)" value="A-101">
                    <input type="text" id="sim-entrada-placa" placeholder="Placa (ej: ABC-123)" value="ABC-123">
                    <button onclick="simularEntrada()">Simular Entrada</button>
                </div>

                <div class="simulator-card">
                    <h4>‚úÖ Simular Salida de Veh√≠culo</h4>
                    <input type="text" id="sim-salida-espacio" placeholder="N√∫mero de espacio (ej: A-101)" value="A-101">
                    <input type="number" id="sim-salida-monto" placeholder="Monto pagado" value="45.50" step="0.01">
                    <button onclick="simularSalida()">Simular Salida</button>
                </div>

                <div class="simulator-card">
                    <h4>üìä Simular Actualizaci√≥n Dashboard</h4>
                    <input type="number" id="sim-dash-disponibles" placeholder="Espacios disponibles" value="45">
                    <input type="number" id="sim-dash-ocupados" placeholder="Espacios ocupados" value="15">
                    <input type="number" id="sim-dash-dinero-hoy" placeholder="Dinero hoy" value="1250.50" step="0.01">
                    <button onclick="simularDashboard()">Simular Dashboard</button>
                </div>

                <div class="simulator-card">
                    <h4>üîÑ Auto-Simulaci√≥n</h4>
                    <select id="auto-sim-interval">
                        <option value="0">Desactivado</option>
                        <option value="5000">Cada 5 segundos</option>
                        <option value="10000">Cada 10 segundos</option>
                        <option value="30000">Cada 30 segundos</option>
                    </select>
                    <button onclick="toggleAutoSimulation()">Activar/Desactivar</button>
                    <p style="font-size: 0.85em; margin-top: 8px; color: #666;">
                        Estado: <span id="auto-sim-status">Desactivado</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="card">
                <h3>Espacios Disponibles</h3>
                <div class="value spaces" id="espacios-disponibles">-</div>
            </div>
            <div class="card">
                <h3>Espacios Ocupados</h3>
                <div class="value" id="espacios-ocupados">-</div>
            </div>
            <div class="card">
                <h3>Total Espacios</h3>
                <div class="value" id="total-espacios">-</div>
            </div>
            <div class="card">
                <h3>Veh√≠culos Activos</h3>
                <div class="value" id="vehiculos-activos">-</div>
            </div>
            <div class="card">
                <h3>Recaudado Hoy</h3>
                <div class="value money" id="dinero-hoy">$0</div>
            </div>
            <div class="card">
                <h3>Recaudado Este Mes</h3>
                <div class="value money" id="dinero-mes">$0</div>
            </div>
        </div>

        <!-- Secciones -->
        <div id="sections" class="sections"></div>

        <!-- Timestamp -->
        <div class="timestamp">
            √öltima actualizaci√≥n: <span id="timestamp">-</span>
        </div>

        <!-- Logs Panel -->
        <div class="logs-panel">
            <h3>üìã Logs de Mensajes</h3>
            <div id="logs" class="logs"></div>
        </div>
    </div>

    <script>
        let ws = null;
        let isConnected = false;
        let autoSimInterval = null;

        // Configuraci√≥n de URLs seg√∫n entorno
        const CONFIG = {
            // Detectar si estamos en producci√≥n o desarrollo
            isProduction: window.location.protocol === 'https:',
            
            // URLs para desarrollo local
            development: {
                wsUrl: 'ws://localhost:8081/ws',
                apiUrl: 'http://localhost:3000'
            },
            
            // URLs para producci√≥n (CAMBIAR estas URLs cuando despliegues)
            production: {
                wsUrl: 'wss://tu-websocket.onrender.com/ws',  // ‚Üê Cambiar cuando despliegues
                apiUrl: 'https://tu-api.vercel.app'            // ‚Üê Cambiar cuando despliegues
            }
        };

        // Obtener URL del WebSocket seg√∫n entorno
        const getWebSocketUrl = () => {
            return CONFIG.isProduction ? CONFIG.production.wsUrl : CONFIG.development.wsUrl;
        };

        // Elementos del DOM
        const wsUrlInput = document.getElementById('ws-url');
        const btnConnect = document.getElementById('btn-connect');
        const btnDisconnect = document.getElementById('btn-disconnect');
        const connectionStatus = document.getElementById('connection-status');
        const logsContainer = document.getElementById('logs');
        
        // Establecer URL por defecto seg√∫n entorno
        wsUrlInput.value = getWebSocketUrl();

        // Conectar
        btnConnect.addEventListener('click', () => {
            const url = wsUrlInput.value.trim();
            if (!url) {
                addLog('Error: URL del WebSocket vac√≠a', 'error');
                return;
            }
            connect(url);
        });

        // Desconectar
        btnDisconnect.addEventListener('click', () => {
            if (ws) {
                ws.close();
                addLog('Desconectando...', 'info');
            }
        });

        function connect(url) {
            if (ws && isConnected) {
                addLog('Ya est√°s conectado', 'info');
                return;
            }

            addLog(`Conectando a ${url}...`, 'info');
            ws = new WebSocket(url);

            ws.onopen = () => {
                isConnected = true;
                console.log('‚úÖ Conectado al WebSocket');
                connectionStatus.className = 'connection-status connected';
                connectionStatus.textContent = '‚úÖ Conectado';
                btnConnect.disabled = true;
                btnDisconnect.disabled = false;
                addLog('‚úÖ Conexi√≥n establecida', 'success');
                
                // Solicitar datos iniciales
                requestDashboard();
                requestEspaciosPorSeccion();
            };

            ws.onclose = () => {
                isConnected = false;
                console.log('‚ùå Desconectado del WebSocket');
                connectionStatus.className = 'connection-status disconnected';
                connectionStatus.textContent = '‚ö†Ô∏è Desconectado';
                btnConnect.disabled = false;
                btnDisconnect.disabled = true;
                addLog('‚ùå Conexi√≥n cerrada', 'error');
            };

            ws.onerror = (error) => {
                console.error('‚ùå Error en WebSocket:', error);
                addLog('‚ùå Error en la conexi√≥n', 'error');
            };

            ws.onmessage = (event) => {
                try {
                    const message = JSON.parse(event.data);
                    addLog(`üì® Recibido: ${message.type}`, 'info');
                    handleMessage(message);
                } catch (error) {
                    addLog(`‚ùå Error parseando mensaje: ${error.message}`, 'error');
                }
            };
        }

        function handleMessage(message) {
            switch(message.type) {
                case 'dashboard_update':
                    updateDashboard(message.data);
                    break;
                case 'espacios_por_seccion':
                    updateSections(message.data);
                    break;
                case 'espacios_disponibles':
                    addLog(`‚úÖ ${message.data.length} espacios disponibles`, 'success');
                    console.log('Espacios disponibles:', message.data);
                    break;
                case 'tickets_activos':
                    addLog(`üé´ ${message.data.length} tickets activos`, 'success');
                    console.log('Tickets activos:', message.data);
                    break;
                case 'espacio_ocupado':
                    showNotification('entrada', message.data);
                    break;
                case 'espacio_liberado':
                    showNotification('salida', message.data);
                    break;
                case 'error':
                    addLog(`‚ùå Error del servidor: ${message.data.message}`, 'error');
                    break;
                default:
                    addLog(`‚ö†Ô∏è Tipo de mensaje desconocido: ${message.type}`, 'info');
            }
        }

        function updateDashboard(data) {
            document.getElementById('espacios-disponibles').textContent = data.espacios_disponibles;
            document.getElementById('espacios-ocupados').textContent = data.espacios_ocupados;
            document.getElementById('total-espacios').textContent = data.total_espacios;
            document.getElementById('vehiculos-activos').textContent = data.vehiculos_activos;
            document.getElementById('dinero-hoy').textContent = '$' + data.dinero_recaudado_hoy.toFixed(2);
            document.getElementById('dinero-mes').textContent = '$' + data.dinero_recaudado_mes.toFixed(2);
            document.getElementById('timestamp').textContent = new Date(data.timestamp).toLocaleString('es-ES');
            addLog('‚úÖ Dashboard actualizado', 'success');
        }

        function updateSections(secciones) {
            const sectionsContainer = document.getElementById('sections');
            sectionsContainer.innerHTML = '';

            if (!secciones || secciones.length === 0) {
                sectionsContainer.innerHTML = '<p style="color: white; text-align: center;">No hay secciones disponibles</p>';
                return;
            }

            secciones.forEach(seccion => {
                const sectionCard = document.createElement('div');
                sectionCard.className = 'section-card';
                
                sectionCard.innerHTML = `
                    <div class="section-header">
                        <h3>Secci√≥n ${seccion.seccion_letra}</h3>
                        <div class="section-stats">
                            <span class="stat available">Disponibles: ${seccion.espacios_disponibles}</span>
                            <span class="stat occupied">Ocupados: ${seccion.espacios_ocupados}</span>
                        </div>
                    </div>
                    <div class="spaces-grid">
                        ${seccion.espacios.map(espacio => `
                            <div class="space ${espacio.estado ? 'available' : 'occupied'}" 
                                 title="${espacio.estado ? 'Disponible' : 'Ocupado' + (espacio.vehiculo_placa ? ' - ' + espacio.vehiculo_placa : '')}">
                                <div>${espacio.numero}</div>
                                ${!espacio.estado && espacio.vehiculo_placa ? 
                                    `<div class="space-info">${espacio.vehiculo_placa}</div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                `;
                
                sectionsContainer.appendChild(sectionCard);
            });
            
            addLog(`‚úÖ ${secciones.length} secciones actualizadas`, 'success');
        }

        function showNotification(type, data) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            if (type === 'entrada') {
                notification.innerHTML = `
                    <h4>üöó Veh√≠culo Ingresado</h4>
                    <p>Espacio: ${data.numero}</p>
                    <p>Placa: ${data.vehiculo_placa}</p>
                    <p>${new Date(data.hora_ingreso).toLocaleTimeString('es-ES')}</p>
                `;
                addLog(`üöó Veh√≠culo ingresado: ${data.vehiculo_placa} en ${data.numero}`, 'info');
            } else {
                notification.innerHTML = `
                    <h4>‚úÖ Veh√≠culo Sali√≥</h4>
                    <p>Espacio: ${data.numero}</p>
                    <p>Pago: $${data.monto_pagado.toFixed(2)}</p>
                    <p>${new Date(data.hora_salida).toLocaleTimeString('es-ES')}</p>
                `;
                addLog(`‚úÖ Veh√≠culo sali√≥ del espacio ${data.numero} - Pago: $${data.monto_pagado.toFixed(2)}`, 'success');
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);

            // Solicitar actualizaci√≥n
            requestDashboard();
            requestEspaciosPorSeccion();
        }

        function requestDashboard() {
            if (!isConnected || !ws) {
                addLog('‚ùå No est√°s conectado', 'error');
                return;
            }
            ws.send(JSON.stringify({ type: 'get_dashboard' }));
            addLog('üì§ Solicitud enviada: get_dashboard', 'info');
        }

        function requestEspaciosPorSeccion() {
            if (!isConnected || !ws) {
                addLog('‚ùå No est√°s conectado', 'error');
                return;
            }
            ws.send(JSON.stringify({ type: 'get_espacios_por_seccion' }));
            addLog('üì§ Solicitud enviada: get_espacios_por_seccion', 'info');
        }

        function requestEspaciosDisponibles() {
            if (!isConnected || !ws) {
                addLog('‚ùå No est√°s conectado', 'error');
                return;
            }
            ws.send(JSON.stringify({ type: 'get_espacios_disponibles' }));
            addLog('üì§ Solicitud enviada: get_espacios_disponibles', 'info');
        }

        function requestTicketsActivos() {
            if (!isConnected || !ws) {
                addLog('‚ùå No est√°s conectado', 'error');
                return;
            }
            ws.send(JSON.stringify({ type: 'get_tickets_activos' }));
            addLog('üì§ Solicitud enviada: get_tickets_activos', 'info');
        }

        function addLog(message, type = 'info') {
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString('es-ES');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        // ========== FUNCIONES DE SIMULACI√ìN ==========

        function simularEntrada() {
            const espacio = document.getElementById('sim-entrada-espacio').value;
            const placa = document.getElementById('sim-entrada-placa').value;

            if (!espacio || !placa) {
                addLog('‚ùå Completa todos los campos para simular entrada', 'error');
                return;
            }

            addLog(`üß™ Simulado: Entrada de ${placa} en ${espacio}`, 'success');

            // Actualizar dashboard simulado (solo local, sin llamar al servidor)
            const disponiblesEl = document.getElementById('espacios-disponibles');
            const ocupadosEl = document.getElementById('espacios-ocupados');
            const activosEl = document.getElementById('vehiculos-activos');
            
            const disponibles = parseInt(disponiblesEl.textContent) || 0;
            const ocupados = parseInt(ocupadosEl.textContent) || 0;
            
            if (disponibles > 0) {
                disponiblesEl.textContent = disponibles - 1;
                ocupadosEl.textContent = ocupados + 1;
                activosEl.textContent = ocupados + 1;
            } else {
                addLog('‚ö†Ô∏è No hay espacios disponibles para simular entrada', 'info');
            }
        }

        function simularSalida() {
            const espacio = document.getElementById('sim-salida-espacio').value;
            const monto = parseFloat(document.getElementById('sim-salida-monto').value);

            if (!espacio || isNaN(monto)) {
                addLog('‚ùå Completa todos los campos para simular salida', 'error');
                return;
            }

            addLog(`üß™ Simulado: Salida del espacio ${espacio} - Monto: $${monto.toFixed(2)}`, 'success');

            // Actualizar dashboard simulado (solo local, sin llamar al servidor)
            const disponiblesEl = document.getElementById('espacios-disponibles');
            const ocupadosEl = document.getElementById('espacios-ocupados');
            const activosEl = document.getElementById('vehiculos-activos');
            const dineroHoyEl = document.getElementById('dinero-hoy');
            
            const disponibles = parseInt(disponiblesEl.textContent) || 0;
            const ocupados = parseInt(ocupadosEl.textContent) || 0;
            const dineroHoy = parseFloat(dineroHoyEl.textContent.replace('$', '')) || 0;

            if (ocupados > 0) {
                disponiblesEl.textContent = disponibles + 1;
                ocupadosEl.textContent = ocupados - 1;
                activosEl.textContent = ocupados - 1;
                dineroHoyEl.textContent = '$' + (dineroHoy + monto).toFixed(2);
            } else {
                addLog('‚ö†Ô∏è No hay veh√≠culos para simular salida', 'info');
            }
        }

        function simularDashboard() {
            const disponibles = parseInt(document.getElementById('sim-dash-disponibles').value);
            const ocupados = parseInt(document.getElementById('sim-dash-ocupados').value);
            const dineroHoy = parseFloat(document.getElementById('sim-dash-dinero-hoy').value);

            const data = {
                espacios_disponibles: disponibles,
                espacios_ocupados: ocupados,
                total_espacios: disponibles + ocupados,
                vehiculos_activos: ocupados,
                dinero_recaudado_hoy: dineroHoy,
                dinero_recaudado_mes: dineroHoy * 20,
                timestamp: new Date().toISOString()
            };

            updateDashboard(data);
            addLog('üß™ Dashboard simulado actualizado', 'success');
        }

        function toggleAutoSimulation() {
            const interval = parseInt(document.getElementById('auto-sim-interval').value);
            const statusEl = document.getElementById('auto-sim-status');

            if (autoSimInterval) {
                clearInterval(autoSimInterval);
                autoSimInterval = null;
                statusEl.textContent = 'Desactivado';
                statusEl.style.color = '#666';
                addLog('üî¥ Auto-simulaci√≥n desactivada', 'info');
                return;
            }

            if (interval === 0) {
                addLog('‚ö†Ô∏è Selecciona un intervalo v√°lido', 'info');
                return;
            }

            autoSimInterval = setInterval(() => {
                const random = Math.random();
                
                if (random < 0.5) {
                    // Simular entrada
                    const placas = ['ABC-123', 'XYZ-789', 'LMN-456', 'PQR-321', 'STU-654'];
                    const espacios = ['A-101', 'A-102', 'B-201', 'B-202', 'C-301'];
                    const placa = placas[Math.floor(Math.random() * placas.length)];
                    const espacio = espacios[Math.floor(Math.random() * espacios.length)];
                    
                    document.getElementById('sim-entrada-espacio').value = espacio;
                    document.getElementById('sim-entrada-placa').value = placa;
                    simularEntrada();
                } else {
                    // Simular salida
                    const espacios = ['A-101', 'A-102', 'B-201', 'B-202', 'C-301'];
                    const espacio = espacios[Math.floor(Math.random() * espacios.length)];
                    const monto = (Math.random() * 100 + 20).toFixed(2);
                    
                    document.getElementById('sim-salida-espacio').value = espacio;
                    document.getElementById('sim-salida-monto').value = monto;
                    simularSalida();
                }
            }, interval);

            statusEl.textContent = 'Activo (' + (interval / 1000) + 's)';
            statusEl.style.color = '#4caf50';
            addLog(`üü¢ Auto-simulaci√≥n activada (cada ${interval / 1000}s)`, 'success');
        }

        // Auto-conectar al cargar
        window.addEventListener('load', () => {
            const entorno = CONFIG.isProduction ? 'üåê PRODUCCI√ìN' : 'üíª DESARROLLO';
            const wsUrl = getWebSocketUrl();
            
            addLog(`Panel de prueba cargado - Entorno: ${entorno}`, 'info');
            addLog(`WebSocket URL: ${wsUrl}`, 'info');
            addLog('Presiona "Conectar" para iniciar', 'info');
            addLog('üß™ Usa el panel de simulaci√≥n para probar eventos', 'info');
        });
    </script>
</body>
</html>
